(()=>{"use strict";var t={371:(t,e,s)=>{t.exports=s.p+"df98692dd8594a41b7ac.gif"}},e={};function s(n){var r=e[n];if(void 0!==r)return r.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,s),o.exports}s.m=t,s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;s.g.importScripts&&(t=s.g.location+"");var e=s.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&!t;)t=n[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=t})(),s.b=document.baseURI||self.location.href,(()=>{const t=document.querySelector(".page"),e=new URL(s(371),s.b),n={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button-save",inactiveButtonClass:"popup__button-save_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error-visible"},r=document.querySelector(".profile__add-button"),o=document.querySelector(".profile__edit-button"),i=document.querySelector(".popup_profile-edit"),a=document.querySelector(".popup_cards").querySelector(".popup__form-cards"),l=(document.querySelector(".profile__add-button"),document.querySelector("#profile-name-input")),h=document.querySelector("#profile-job-input"),c=t.querySelector(".profile__avatar"),u=t.querySelector("#formEditAvatar");document.querySelector(".elements__list");class _{constructor(t,e,s,n,r,o,i){this._name=t.name,this._link=t.link,this._templateSelector=e,this._element=this._getTemplate(),this._heart=this._element.querySelector(".card__like-button"),this._buttonDelete=this._element.querySelector(".card__delete-button"),this._popupImage=document.querySelector(".popup_open-image"),this._galleryPic=this._element.querySelector(".card__image"),this._handleCardClick=s,this._handleDeleteClick=n,this._handleLikeClick=r,this._userId=i,this._ownerId=o.owner._id,this._cardId=o._id,this._arrayLikes=o.likes}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".elements__item").cloneNode(!0)}generateCard(t){this._setEventListeners(),this._galleryPic.src=this._link,this._galleryPic.alt=this._name;const e=this._element.querySelector(".card__title"),s=this._element.querySelector(".card__like-count");return e.textContent=this._name,s.textContent=t,this._ownerId!=this._userId&&this._buttonDelete.remove(),this._arrayLikes.forEach((t=>{t._id===this._userId&&this._toggleLike()})),this._element}_setEventListeners(){this._heart.addEventListener("click",(t=>{this._countElement=t.target.nextElementSibling,this._heart.classList.contains("card__like-button_active")?this._handleLikeClick(this._cardId,!1).then((()=>this._toggleLike())).catch((t=>console.log(t))):this._handleLikeClick(this._cardId,!0).then((()=>this._toggleLike())).catch((t=>console.log(t)))})),this._buttonDelete.addEventListener("click",(()=>{this._handleDeleteClick(this._element)})),this._galleryPic.addEventListener("click",(()=>{this._handleCardClick()}))}_toggleLike(){this._heart.classList.toggle("card__like-button_active")}loadLike(t){this._countElement.textContent=t.likes.length}deleteImage(){this._element.remove()}}class p{constructor(t){this._popup=document.querySelector(t),this._buttonClosePopup=this._popup.querySelector(".popup__button-close"),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_opened"),this._popup.addEventListener("mousedown",this._handleOverlayClose),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),this._popup.removeEventListener("mousedown",this._handleOverlayClose),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._buttonClosePopup.addEventListener("click",(()=>{this.close()})),this._popup.addEventListener("click",(t=>{t.target===this._popup&&this.close()}))}_handleEscClose(t){"Escape"===t.key&&this.close()}_handleOverlayClose(t){t.target===this._popup&&this.close()}}class d extends p{constructor({selector:t,handleFormSubmit:e}){super(t),this._handleFormSubmit=e,this._form=this._popup.querySelector(".popup__form"),this._inputList=this._form.querySelectorAll(".popup__input"),this._submitButton=this._form.querySelector(".popup__button-save"),this._submitButtonText=this._submitButton.textContent,this._formValues={}}_getInputValues(){return this._inputList.forEach((t=>{this._formValues[t.name]=t.value})),this._formValues}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(t=>{t.preventDefault(),this._submitButton.textContent="Сохранение...",this._handleFormSubmit(this._getInputValues()).then((()=>{this.close(),this._submitButton.textContent=this._submitButtonText})).catch((t=>{console.log(t),this._submitButton.textContent=this._submitButtonText}))}))}close(){super.close(),this._form.reset()}}class m{constructor(t,e){this._form=e,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._formInputs=Array.from(this._form.querySelectorAll(this._inputSelector)),this._formButton=this._form.querySelector(this._submitButtonSelector)}_showInputError(t){const e=t.parentNode.querySelector(`#${t.id}-error`);t.classList.add(this._inputErrorClass),e.classList.add(this._errorClass),e.textContent=t.validationMessage}_hideInputError(t){const e=t.parentNode.querySelector(`#${t.id}-error`);t.classList.remove(this._inputErrorClass),e.classList.remove(this._errorClass),e.textContent=""}hideAllInputErrors(){this._formInputs.forEach((t=>{this._hideInputError(t)}))}_checkInputValidity(t){t.checkValidity()?this._hideInputError(t):this._showInputError(t)}_hasInvalidInput(){return this._formInputs.some((t=>!t.validity.valid))}_toggleButtonState(){this._hasInvalidInput(this._formInputs)?this.disableButton(this._formButton):this._enableButton(this._formButton)}disableButton=()=>{this._formButton.classList.add(this._inactiveButtonClass),this._formButton.setAttribute("disabled",!0)};_enableButton(){this._formButton.classList.remove(this._inactiveButtonClass),this._formButton.removeAttribute("disabled")}_setEventListeners(){this.disableButton(this._formButton),this._formInputs.forEach((t=>{t.addEventListener("input",(()=>{this._checkInputValidity(t),this._toggleButtonState()})),this._hideInputError(t)}))}enableValidation(){this._form.addEventListener("submit",(t=>{t.preventDefault(),this.validateForm()})),this._setEventListeners()}validateForm(){this._toggleButtonState(),this._formInputs.forEach((t=>{this._checkInputValidity(t),this._hideInputError(t)}))}}const f=new class{constructor(t,e){this._apiPath=t,this._token=e,this.userId=null}_getResponseData(t){return t.ok?t.json():Promise.reject(`Ошибка: ${t.status}`)}getUserInfo(){return fetch(`${this._apiPath}/users/me`,{headers:{authorization:this._token}}).then((t=>this._getResponseData(t))).then((t=>(this.userId=t._id,t)))}getCards(){return fetch(`${this._apiPath}/cards`,{headers:{authorization:this._token}}).then((t=>this._getResponseData(t)))}editProfile(t){return fetch(`${this._apiPath}/users/me`,{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:t.name,about:t.profession})}).then((t=>this._getResponseData(t)))}editAvatar(t){return fetch(`${this._apiPath}/users/me/avatar`,{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({avatar:t.link})}).then((t=>this._getResponseData(t)))}addCard(t){return fetch(`${this._apiPath}/cards`,{method:"POST",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:t.name,link:t.link})}).then((t=>this._getResponseData(t)))}deleteCard(t){return fetch(`${this._apiPath}/cards/${t}`,{method:"DELETE",headers:{authorization:this._token}}).then((t=>this._getResponseData(t)))}addLike(t){return fetch(`${this._apiPath}/cards/${t}/likes`,{method:"PUT",headers:{authorization:this._token}}).then((t=>this._getResponseData(t)))}deleteLike(t){return fetch(`${this._apiPath}/cards/${t}/likes`,{method:"DELETE",headers:{authorization:this._token}}).then((t=>this._getResponseData(t)))}}("https://mesto.nomoreparties.co/v1/cohort-66","dc4cc52d-8535-4ff0-845c-06f4815ac82c"),g=new class extends p{constructor(t){super(t),this._imageElement=this._popup.querySelector(".popup__image"),this._captionElement=this._popup.querySelector(".popup__image-caption")}open(t,e){super.open(),this._imageElement.src=e,this._imageElement.alt=t,this._captionElement.textContent=t}}(".popup_open-image");function v(t){const e=new _(t,".card__template",(()=>{g.open(t.name,t.link)}),(()=>{q.open(t._id,e)}),((t,s)=>function(t,e,s){return new Promise(e?(e,n)=>{f.addLike(t).then((t=>{s.loadLike(t),e()})).catch((t=>{console.log(t),n(t)}))}:(e,n)=>{f.deleteLike(t).then((t=>{s.loadLike(t),e()})).catch((t=>{console.log(t),n(t)}))})}(t,s,e)),t,f.userId);return e}g.setEventListeners();const b=new class{constructor({items:t,renderer:e},s){this._initialArray=t,this._renderer=e,this._container=document.querySelector(s)}setItems(t){this._initialArray=t}renderItems(){this._initialArray.forEach((t=>this._renderer(t)))}addItem(t){this._container.append(t)}}({items:[],renderer:t=>{b.addItem(v(t).generateCard(t.likes.length))}},".elements__list");c.style.backgroundImage=`url(${e})`,Promise.all([f.getCards(),f.getUserInfo()]).then((t=>{b.setItems(t[0].reverse()),b.renderItems(),C.setUserInfo({name:t[1].name,profession:t[1].about}),C.setAvatar(t[1].avatar)})).catch((t=>{console.log(t)})),r.addEventListener("click",(function(){y.hideAllInputErrors(),E.open()}));const y=new m(n,a);y.enableValidation();const E=new d({selector:".popup_cards",handleFormSubmit:function(t){return new Promise(((e,s)=>{f.addCard(t).then((t=>{b.addItem(v(t).generateCard(t.likes.length)),e()})).catch((t=>{console.log(t),s(t)}))}))}});E.setEventListeners();const k=new m(n,i);k.enableValidation();const S=new d({selector:".popup_profile-edit",handleFormSubmit:function(t){return f.editProfile(t).then((()=>{f.getUserInfo().then((t=>{C.setUserInfo({name:t.name,profession:t.about})})).catch((t=>console.log(`Ошибка: ${t}`)))})).catch((t=>{console.log(t)}))}});S.setEventListeners();const C=new class{constructor({username:t,job:e,avatar:s}){this._username=document.querySelector(t),this._job=document.querySelector(e),this._avatar=document.querySelector(s)}getUserInfo(){return{username:this._username.textContent,job:this._job.textContent}}setUserInfo({name:t,profession:e}){this._username.textContent=t,this._job.textContent=e}setAvatar(t){this._avatar.style.backgroundImage=`url(${t})`}}({username:".profile__name",job:".profile__description",avatar:".profile__avatar"});c.addEventListener("click",(function(){u.link.value=c.style.backgroundImage.slice(5,-2),I.hideAllInputErrors(),L.open()}));const I=new m(n,u);I.enableValidation();const L=new d({selector:".popup_edit-avatar",handleFormSubmit:function(t){return new Promise(((s,n)=>{f.editAvatar(t).then((()=>{c.style.backgroundImage=`url(${e})`,f.getUserInfo().then((t=>{C.setAvatar(t.avatar)})).catch((t=>console.log(t))),s()})).catch((t=>{console.log(t),n(t)}))}))}});L.setEventListeners();const q=new class extends p{constructor({selector:t,handleFormSubmit:e}){super(t),this._handleFormSubmit=e}open(t,e){super.open(),this._idCard=t,this._cardInstance=e}setEventListeners(){super.setEventListeners(),this._popup.addEventListener("submit",(t=>{t.preventDefault(),this._handleFormSubmit(this._idCard,this._cardInstance).then((()=>this.close())).catch((t=>console.log(t)))}))}}({selector:".popup_delete-card",handleFormSubmit:function(t,e){return new Promise(((s,n)=>{f.deleteCard(t).then((()=>{e.deleteImage(),s()})).catch((t=>{console.log(t),n(t)}))}))}});q.setEventListeners(),o.addEventListener("click",(function(){k.hideAllInputErrors(),S.open()})),o.addEventListener("click",(()=>{const t=C.getUserInfo();!function({username:t,job:e}){l.value=t,h.value=e}({username:t.username,job:t.job})}))})()})();