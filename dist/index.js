(()=>{"use strict";const e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button-save",inactiveButtonClass:"popup__button-save_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error-visible"},t=document.querySelector(".profile__add-button"),s=document.querySelector(".profile__edit-button"),r=document.querySelector(".popup_profile-edit"),n=document.querySelector(".popup_cards").querySelector(".popup__form-cards"),o=(document.querySelector(".profile__add-button"),document.querySelector("#profile-name-input")),i=document.querySelector("#profile-job-input");class l{constructor(e,t,s){this._name=e.name,this._link=e.link,this._templateSelector=t,this._element=this._getTemplate(),this._heart=this._element.querySelector(".card__like-button"),this._buttonDelete=this._element.querySelector(".card__delete-button"),this._popupImage=document.querySelector(".popup_open-image"),this._galleryPic=this._element.querySelector(".card__image"),this._handleCardClick=s}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".elements__item").cloneNode(!0)}generateCard(){return this._element=this._getTemplate(),this._setEventListeners(),this._element.querySelector(".card__image").src=this._link,this._element.querySelector(".card__title").textContent=this._name,this._element.querySelector(".card__image").alt=this._name,this._element}_setEventListeners(){this._element.querySelector(".card__like-button").addEventListener("click",(()=>{this._likeCard()})),this._element.querySelector(".card__delete-button").addEventListener("click",(()=>{this._deleteCard()})),this._element.querySelector(".card__image").addEventListener("click",(()=>{this._handleCardClick()}))}_likeCard(){this._element.querySelector(".card__like-button").classList.toggle("card__like-button_active")}_deleteCard(){this._element.remove(),this._element=null}_handleCardClick(){popupImage.src=this._link,popupImage.alt=this._name,popupImageCaption.textContent=this._name,openPopup(popupOpenImage)}}class a{constructor(e){this._popup=document.querySelector(e),this._buttonClosePopup=this._popup.querySelector(".popup__button-close"),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_opened"),this._popup.addEventListener("mousedown",this._handleOverlayClose),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),this._popup.removeEventListener("mousedown",this._handleOverlayClose),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._buttonClosePopup.addEventListener("click",(()=>{this.close()})),this._popup.addEventListener("click",(e=>{e.target===this._popup&&this.close()}))}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleOverlayClose(e){e.target===this._popup&&this.close()}}class u extends a{constructor({selector:e,handleFormSubmit:t}){super(e),this._handleFormSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._inputList=this._form.querySelectorAll(".popup__input"),this._submitButton=this._form.querySelector(".form__submit-button"),this._formValues={}}_getInputValues(){return this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues()),this.close()}))}close(){super.close(),this._form.reset()}}class p{constructor(e,t){this._form=t,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formInputs=Array.from(this._form.querySelectorAll(this._inputSelector)),this._formButton=this._form.querySelector(this._submitButtonSelector)}_showInputError(e){const t=e.parentNode.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),t.classList.add(this._errorClass),t.textContent=e.validationMessage}_hideInputError(e){const t=e.parentNode.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}hideAllInputErrors(){this._formInputs.forEach((e=>{this._hideInputError(e)}))}_checkInputValidity(e){e.checkValidity()?this._hideInputError(e):this._showInputError(e)}_hasInvalidInput(){return this._formInputs.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput(this._formInputs)?this.disableButton(this._formButton):this._enableButton(this._formButton)}disableButton=()=>{this._formButton.classList.add(this._inactiveButtonClass),this._formButton.setAttribute("disabled",!0)};_enableButton(){this._formButton.classList.remove(this._inactiveButtonClass),this._formButton.removeAttribute("disabled")}_setEventListeners(){this.disableButton(this._formButton),this._formInputs.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()})),this._hideInputError(e)}))}enableValidation(){this._form.addEventListener("submit",(e=>{e.preventDefault(),this.validateForm()})),this._setEventListeners()}validateForm(){this._toggleButtonState(),this._formInputs.forEach((e=>{this._checkInputValidity(e),this._hideInputError(e)}))}}const _=new class extends a{constructor(e){super(e),this._imageElement=this._popup.querySelector(".popup__image"),this._captionElement=this._popup.querySelector(".popup__image-caption")}open(e,t){super.open(),this._imageElement.src=t,this._imageElement.alt=e,this._captionElement.textContent=e}}(".popup_open-image"),c=new class{constructor({items:e,renderer:t},s){this._initialArray=e,this._renderer=t,this._container=document.querySelector(s)}renderItems(){this._initialArray.forEach((e=>this._renderer(e)))}addItem(e){this._container.prepend(e)}}({items:[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],renderer:e=>{c.addItem(new l(e,".card__template",(()=>{_.open(e.name,e.link),_.setEventListeners()})).generateCard())}},".elements__list");c.renderItems(),t.addEventListener("click",(function(){d.hideAllInputErrors(),d._toggleButtonState(),h.open()}));const d=new p(e,n);d.enableValidation();const h=new u({selector:".popup_cards",handleFormSubmit:function(e){const t=new l(e,".card__template",(()=>{_.open(e.name,e.link),_.setEventListeners()})).generateCard();c.addItem(t)}});h.setEventListeners();const m=new p(e,r);m.enableValidation();const f=new u({selector:".popup_profile-edit",handleFormSubmit:function(e){v.setUserInfo({name:e.name,profession:e.profession})}});f.setEventListeners();const v=new class{constructor({username:e,job:t}){this._username=document.querySelector(e),this._job=document.querySelector(t)}getUserInfo(){return{username:this._username.textContent,job:this._job.textContent}}setUserInfo(e){this._username.textContent=e.name,this._job.textContent=e.profession}}({username:".profile__name",job:".profile__description"});s.addEventListener("click",(function(){m.hideAllInputErrors(),f.open()})),s.addEventListener("click",(()=>{const e=v.getUserInfo();!function({username:e,job:t}){o.value=e,i.value=t}({username:e.username,job:e.job})}))})();